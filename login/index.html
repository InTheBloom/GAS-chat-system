<!DOCTYPE html>

<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>ログイン</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="/src/utils.js"></script>
        <script src="/src/variables.js"></script>
        <script src="/src/request.js"></script>

<script>
function display_current_info () {
    const current_user_name_frame = document.getElementById("current_user_name");
    const current_password_frame = document.getElementById("current_password");

    current_user_name_frame.innerHTML = localStorage.getItem("user");
    current_password_frame.innerHTML = localStorage.getItem("password");
}
</script>

<script>
/* Entry point */
function main () {
    if (!storageAvailable("localStorage")) {
        alert("ログイン機能を利用するためにはlocalStorageが有効である必要があります。");
        return;
    }

    display_current_info();

    document.getElementById("verify_btn").addEventListener("click", async () => {
        const user_name_input = document.getElementById("user_name");
        const password_input = document.getElementById("password");

        const user_name = escapeHtml(user_name_input.value);
        const password = password_input.value;

        // フォーム削除
        user_name_input.value = "";
        password_input.value = "";

        await login();
        display_current_info();
    });
};

document.addEventListener("DOMContentLoaded", () => main());
</script>
    </head>

    <body>
        <h1>ログインフォーム</h1>

        <h2>現在のログイン情報</h2>
        <div>
            <p>ユーザ名: <span id="current_user_name"></span></p>
            <p>パスワード: <span id="current_password"></span></p>
        </div>

        <h2>ログイン/新規ユーザ作成</h2>
        <label for="user_name">ユーザ名</label>
        <input type="text" name="user_name" id="user_name">
        <label for="password">パスワード</label>
        <input type="text" name="password" id="password">
        <button id="verify_btn">ログイン/サインイン</button>
    </body>
</html>
